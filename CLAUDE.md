# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## プロジェクト概要

Tap Ripple (タップリップル) は React と TypeScript で構築されたインタラクティブな音楽ゲームです。画面をタップすると視覚的な波紋が生成され、音楽ノートが再生されます。波紋が重なると和音が生成されます。

## 開発コマンド

### 必須コマンド

```bash
# 開発サーバーの起動
npm run dev

# プロダクションビルド
npm run build

# コードのリント
npm run lint

# リントエラーの自動修正
npm run lint:fix

# コードのフォーマット
npm run format

# プロダクションビルドのプレビュー
npm run preview
```

### 重要事項

- このプロジェクトは ESLint の代わりに **Biome** を使用してリントとフォーマットを行います
- テストフレームワークは現在設定されていません
- TypeScript は strict モードが有効になっています
- シングルページアプリケーションでルーティングはありません
- 全てのゲームロジックは意図的に1つのコンポーネントに集約されています

## アーキテクチャ

### コアコンポーネント構造

全てのゲームロジックは `src/TapRipple.tsx` (845行) に含まれており、以下を管理します：

- ゲーム状態 (menu, playing, gameover)
- 3つのゲームモード (zen, score, time)
- Canvas ベースの波紋アニメーション
- Web Audio API による音声生成
- タッチとマウスイベントの処理

### 主要な技術パターン

1. **パフォーマンス最適化**: React の再レンダリングを避けるため、ゲームオブジェクトに `useRef` を使用
2. **Audio Context**: ブラウザの自動再生ポリシーに準拠するための遅延初期化
3. **Canvas レンダリング**: 60fps を実現するため、requestAnimationFrame で直接 Canvas API を使用
4. **音楽システム**:
   - 5つの音階 (メジャー、マイナー、ペンタトニック、ブルース、日本音階)
   - 垂直方向の音程マッピング (上が高音、下が低音)
   - 波紋が重なった時の和音生成

### 状態管理

- ゲーム状態は React hooks で管理
- 外部の状態管理ライブラリは使用していません
- ゲームオブジェクト (波紋、パーティクル、ターゲット) はパフォーマンスのため refs に保存

### カスタマイズポイント

`src/TapRipple.tsx` 内の変更可能な主要定数：

- `scales` オブジェクト: 音階の定義 (12行目付近)
- `colors` オブジェクト: ビジュアルテーマの色 (30行目付近)
- `bpm` 定数: リズムグリッドのテンポ (デフォルト: 120)

## コードスタイル

このコードベースで作業する際は：

- `biome.json` の Biome デフォルト設定に従ってください
- Biome のデフォルトフォーマットルールが適用されます（ダブルクォート、セミコロンあり、タブインデント）

## Git コミットルール

### 基本ルール

- **コミットメッセージは必ず日本語で記述してください**
- 変更内容を簡潔に要約してください
- 必要に応じて箇条書きで詳細を追加してください

### コミットの分割

**コミットは論理的なステップに分けて行ってください：**

1. **機能ごとに分ける**: 新機能、バグ修正、リファクタリングは別々のコミットに
2. **設定変更を分離**: 設定ファイルの変更は独立したコミットに
3. **ドキュメント更新を分離**: README.md や CLAUDE.md の更新は別のコミットに
4. **依存関係の更新を分離**: package.json の変更は独立したコミットに
5. **フォーマット変更を分離**: コードフォーマットのみの変更は別のコミットに

### コミットメッセージの例

```text
機能: タップ時のアニメーション効果を追加

- 波紋の拡大アニメーションを実装
- パーティクルエフェクトを追加
- アニメーション速度の調整機能を追加
```

```text
修正: Canvas のメモリリークを解消

- アニメーションフレームの適切なキャンセル処理を追加
- 未使用のイベントリスナーを削除
```

```text
設定: Biome の設定を更新

- インポート文の自動整理を有効化
- 行末のセミコロンルールを調整
```
